<!DOCTYPE html>
<html>
<head>
  <title>æ›´æ–°æ–‡ä»¶å‘é€ç«¯</title>
  <style>
    .container { max-width: 600px; margin: 50px auto; padding: 20px; border: 1px solid #eee; border-radius: 8px; }
    .title { color: #2d7dff; font-size: 18px; margin-bottom: 20px; }
    .file-box { margin: 15px 0; padding: 10px; border: 1px dashed #ccc; cursor: pointer; }
    .file-box:hover { border-color: #2d7dff; }
    #fileInfo { color: #666; margin: 10px 0; }
    #uploadBtn { background: #2d7dff; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
    #uploadBtn:disabled { background: #ccc; cursor: not-allowed; }
    .progress { height: 8px; background: #f5f5f5; border-radius: 4px; margin: 15px 0; overflow: hidden; }
    .progress-bar { height: 100%; background: #2d7dff; width: 0%; transition: width 0.3s; }
    .link-area { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 4px; }
    #receiveLink { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin: 10px 0; }
    #copyBtn { background: #4cae4c; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
    #status { margin-top: 15px; color: #333; }
  </style>
</head>
<body>
  <div class="container">
    <div class="title">ğŸ“¤ æ›´æ–°æ–‡ä»¶å‘é€ï¼ˆæ–°æ–‡ä»¶è‡ªåŠ¨è¦†ç›–æ—§æ–‡ä»¶ï¼‰</div>
    
    <!-- 1. æ–‡ä»¶é€‰æ‹©åŒº -->
    <div class="file-box" onclick="document.getElementById('fileInput').click()">
      ç‚¹å‡»é€‰æ‹©è¦æ¨é€çš„HTMLæ›´æ–°æ–‡ä»¶ï¼ˆä»…æ”¯æŒ.htmlæ ¼å¼ï¼‰
      <input type="file" id="fileInput" accept=".html" style="display: none;" onchange="showFileName()">
    </div>
    <div id="fileInfo">æœªé€‰æ‹©æ–‡ä»¶</div>

    <!-- 2. ä¸Šä¼ æŒ‰é’®+è¿›åº¦æ¡ -->
    <button id="uploadBtn" disabled onclick="uploadFile()">å¼€å§‹æ¨é€æ–‡ä»¶</button>
    <div class="progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- 3. æ¥æ”¶ç«¯é“¾æ¥ï¼ˆç”Ÿæˆåå¯å¤åˆ¶ç»™å‰ç«¯ï¼‰ -->
    <div class="link-area">
      <div>å‰ç«¯æ¥æ”¶é“¾æ¥ï¼ˆå¤åˆ¶åæ‰“å¼€å³å¯çœ‹åˆ°å…¬å‘Šï¼‰ï¼š</div>
      <input type="text" id="receiveLink" readonly>
      <button id="copyBtn" onclick="copyLink()">å¤åˆ¶é“¾æ¥</button>
    </div>

    <!-- 4. æ“ä½œçŠ¶æ€æç¤º -->
    <div id="status">æç¤ºï¼šæ¨é€åï¼Œå‰ç«¯æœªæ›´æ–°å‰å…¬å‘Šä¸ä¼šæ¶ˆå¤±ï¼›ä¸Šä¼ æ–°æ–‡ä»¶ä¼šè‡ªåŠ¨è¦†ç›–æ—§çš„</div>
  </div>

<script>
// æœåŠ¡å™¨åŸºç¡€é…ç½®ï¼ˆæ›¿æ¢æˆä½ çš„æœåŠ¡å™¨IPå’Œç«¯å£ï¼Œå’Œä¹‹å‰çš„åç«¯ä¸€è‡´ï¼‰
const serverIP = "ä½ çš„æœåŠ¡å™¨IP";
const serverPort = "3000";
const receiveLink = `http://${serverIP}:${serverPort}/index.html`; // å‰ç«¯æ¥æ”¶é¡µé¢é“¾æ¥
document.getElementById('receiveLink').value = receiveLink; // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆé“¾æ¥

// 1. æ˜¾ç¤ºé€‰æ‹©çš„æ–‡ä»¶å
function showFileName() {
  const fileInput = document.getElementById('fileInput');
  const fileInfo = document.getElementById('fileInfo');
  const uploadBtn = document.getElementById('uploadBtn');
  
  if (fileInput.files[0]) {
    const file = fileInput.files[0];
    if (file.type !== 'text/html' && !file.name.endsWith('.html')) {
      fileInfo.textContent = `âŒ é”™è¯¯ï¼šä»…æ”¯æŒ.htmlæ ¼å¼æ–‡ä»¶`;
      uploadBtn.disabled = true;
    } else {
      fileInfo.textContent = `å·²é€‰æ‹©ï¼š${file.name}ï¼ˆå¤§å°ï¼š${(file.size/1024).toFixed(2)}KBï¼‰`;
      uploadBtn.disabled = false;
    }
  } else {
    fileInfo.textContent = "æœªé€‰æ‹©æ–‡ä»¶";
    uploadBtn.disabled = true;
  }
}

// 2. æ¨é€æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼ˆå¯¹æ¥åç«¯æ¥å£ï¼Œè‡ªåŠ¨è¦†ç›–æ—§æ–‡ä»¶ï¼‰
function uploadFile() {
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];
  const progressBar = document.getElementById('progressBar');
  const status = document.getElementById('status');
  
  const formData = new FormData();
  formData.append('updateHtml', file); // å’Œåç«¯æ¥å£å‚æ•°ä¸€è‡´

  const xhr = new XMLHttpRequest();
  xhr.open('POST', `http://${serverIP}:${serverPort}/uploadNewFile`); // å¯¹æ¥åç«¯ä¸Šä¼ æ¥å£

  // å®æ—¶æ›´æ–°ä¸Šä¼ è¿›åº¦
  xhr.upload.onprogress = (e) => {
    if (e.lengthComputable) {
      const progress = (e.loaded / e.total) * 100;
      progressBar.style.width = `${progress}%`;
      status.textContent = `æ¨é€ä¸­ï¼š${progress.toFixed(0)}%`;
    }
  };

  // ä¸Šä¼ å®Œæˆæç¤º
  xhr.onload = () => {
    const res = JSON.parse(xhr.responseText);
    if (res.success) {
      progressBar.style.width = "100%";
      status.textContent = `âœ… æ¨é€æˆåŠŸï¼å‰ç«¯æ‰“å¼€é“¾æ¥å³å¯çœ‹åˆ°å…¬å‘Šï¼ˆæœªæ›´æ–°å‰ä¸ä¼šæ¶ˆå¤±ï¼‰`;
    } else {
      status.textContent = `âŒ æ¨é€å¤±è´¥ï¼š${res.msg}`;
    }
  };

  xhr.onerror = () => {
    status.textContent = `âŒ æ¨é€å¤±è´¥ï¼šæ— æ³•è¿æ¥æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥IPå’Œç«¯å£`;
  };

  xhr.send(formData);
}

// 3. å¤åˆ¶æ¥æ”¶ç«¯é“¾æ¥
function copyLink() {
  const linkInput = document.getElementById('receiveLink');
  linkInput.select();
  document.execCommand('copy');
  document.getElementById('status').textContent = `âœ… é“¾æ¥å·²å¤åˆ¶ï¼å‰ç«¯æ‰“å¼€å³å¯æ¥æ”¶`;
}
</script>
</body>
</html>
